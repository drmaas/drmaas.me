---

---

<div class="container mx-auto px-4 py-8 max-w-4xl">
    <div class="flex flex-col space-y-6">
        <input
            id="search"
            aria-label="search box"
            autofocus
            type="text"
            placeholder="Search articles..."
            class="input input-bordered input-info w-full max-w-lg mx-auto"
        />
        <div id="results" class="flex flex-col gap-6 w-full">
        </div>
    </div>
</div>

<script>
    interface ResultInterface {
        title: string;
        url: string;
        date: string;
        description?: string;
    }
    import Fuse, { FuseResult } from "fuse.js";

    const baseSite = import.meta.env.BASE_URL;
    const posts = await fetch(`${baseSite}search/search.json`).then((resp) =>
        resp.json(),
    );

    let fuse: Fuse<ResultInterface>;

    async function initSearch() {
        const options = {
            ignoreLocation: true,
            keys: ["title", "description"],
        };
        fuse = new Fuse(posts, options);
    }

    function renderResults(results: ResultInterface[]) {
        let html = "";
        for (const result of results) {
            html += `
            <div class="card bg-base-200 w-full shadow-lg hover:shadow-xl transition-shadow duration-200 focus-within:outline focus-within:outline-2 focus-within:outline-secondary">
              <div class="card-body"> 
                <a href="${result.url}" class="no-underline text-cyan-600 hover:text-black dark:hover:text-white">
                  <h2 class="card-title">${result.title}</h2>
                </a>
                <span class="text-sm opacity-70">${result.date}</span>
                <p class="line-clamp-4 md:line-clamp-3">${result.description}</p>
              </div>
            </div>
            `;
        }
        const resultsElement = document.querySelector("#results");
        if (resultsElement) {
            resultsElement.innerHTML = html;
        }
    }

    function performSearch() {
        const input = document.querySelector<HTMLInputElement>("#search");
        if (!input) return;

        const pattern = input.value;
        const results: FuseResult<ResultInterface>[] = fuse.search(pattern);
        const resultItems = results.map((r) => r.item);
        renderResults(resultItems);
    }

    async function setup() {
        await initSearch();
        performSearch();

        const input = document.querySelector<HTMLInputElement>("#search");
        if (input) {
            input.addEventListener("input", performSearch);
        }
    }

    setup();
</script>

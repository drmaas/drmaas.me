---
import { parse } from "node-html-parser";
import { fileToSlug } from "src/misc";
import DateComponent from "./DateComponent.astro";
import ReadingTimeComponent from "./ReadingTimeComponent.astro";
import type { CollectionEntry } from "astro:content";

export interface Props {
  content: CollectionEntry<"posts">;
  lazyLoading?: boolean;
}

const { content, lazyLoading } = Astro.props as Props;

const rendered = content.rendered?.html ?? "";

const description =
  content.data.description ||
  parse(rendered).querySelector("p:first-of-type")?.innerText;

const url = `/articles/${fileToSlug(content.filePath ?? "", "md")}`;

const date = new Date(content.data.date).toDateString();
---

<div
  class="card sm:card-side bg-base-100 shadow-lg hover:shadow-2xl transition-all duration-300 w-full border border-base-300/50 hover:border-primary/50 overflow-hidden"
>
  {
    content.data.image ? (
      <figure class="sm:w-80 sm:flex-shrink-0">
        <img
          width="300"
          height="200"
          loading={lazyLoading ? "lazy" : "eager"}
          class="w-full h-full object-cover aspect-video sm:aspect-auto"
          src={content.data.image}
          alt={content.data.imageDescription ?? content.data.title}
          transition:name={content.data.image}
        />
      </figure>
    ) : null
  }

  <div class="card-body">
    <a
      href={url}
      class="no-underline text-primary hover:text-primary-focus transition-colors duration-200"
    >
      <h2 class="card-title text-2xl mb-2">{content.data.title}</h2>
    </a>
    <div class="flex items-center gap-3 text-sm opacity-70 mb-3">
      <DateComponent date={date} />
      <span class="text-base-300">â€¢</span>
      <ReadingTimeComponent content={rendered} />
    </div>
    <p class="line-clamp-3 text-base">
      {description}
    </p>
  </div>
</div>
